{% extends 'back_office/base.html' %}
{% load i18n static back_office_extras %}
{% block content %}
{% with page_title=analysis %}
{% include 'back_office/snippets/breadcrumbs.html' %}
{% endwith %}

<div class="flex flex-col lg:flex-row lg:space-x-4">
    <div>
        <form method="post" id="analysis_update_form" x-data="{ submitDisabled: true }" @change="submitDisabled = false">{% csrf_token %}
        {{ form.non_field_errors }}
        <div class="bg-white rounded-lg shadow mb-4 px-4">
            <div class="flex flex-col mb-4">
                <div class="py-6">
                    <h2 class="text-xl font-semibold mb-4">{% trans "Risk analysis" %}</h2>
                    {{ form.non_field_errors }}
                    {{ form.errors }}
                    <div id="update_analysis-form">
                        {% for field in form %}
                        {% if field.field.widget|class == "CheckboxInput" %}
                            {% include 'back_office/snippets/form_field_row.html' %}
                        {% else %}
                        <div class="mb-6">
                            <label class="form-label">{{ field.label|striptags }} {% if field.field.required %}<span class="text-red-500">*</span>{% endif %}</label>
                            <div>
                            {{ field.errors }}
                            {% if field.field.widget.attrs.select_disabled %}
                                <select disabled class="bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-blue-500 focus:border-blue-500 block w-full p-2.5 disabled:opacity-50">
                                <option value={{ field.value }}>{{ field.initial }}</option>
                                </select>
                                <input type="hidden" name="{{ field.name }}" value="{{ field.value }}">
                            {% else %}
                                {{ field }}
                            {% endif %}
                            <p class="help_text">{{ field.help_text }}</p>
                            </div>
                        </div>
                        {% endif %}
                        {% endfor %}

                        <section class="col-start-3 col-span-6 place-content-end">
                            <section class="grid grid-cols-2 place-content-end">
                            <button onclick="window.history.back()" class="bg-gray-300 text-black aliased font-medium p-4 py-1.5 w-18 rounded-lg hover:bg-gray-200">{% trans "Cancel" %}</button>
                            <input type="hidden" form="analysis_update_form" name="next" value={{ request.GET.next }}>
                            <button id="analysis_save" type="submit" :disabled="submitDisabled"
                                class="inline-block font-normal text-center px-3 py-2 leading-normal text-base rounded cursor-pointer text-white bg-indigo-800 hover:bg-indigo-600 ml-2 disabled:bg-indigo-400">
                                {% trans "Save" %}
                            </button>
                            </section>
                        </section>
                    </div>
                </div>
            </div>
        </div>
        </form>
    </div>
    <div class="bg-white rounded-lg shadow px-4 py-6 w-full">
        <div class="grid justify-items-stretch grid-cols-2 mb-2">
            <h2 class="text-xl font-semibold">{% trans "Associated risk scenarios" %}</h2>
            {% include 'back_office/snippets/add_button_modal.html' with form=risk_scenario_create_form header=_("Add Risk Scenario") model="risk-scenario" content=_("New risk scenario") %}
        </div>
        {% include 'back_office/snippets/ri_list_nested.html' %}
    </div>
</div>
{% endblock %}