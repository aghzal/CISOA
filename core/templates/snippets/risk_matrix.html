{% load i18n back_office_extras %}

{% if data %}
    <table class="w-full p-2">
        {% for row in matrix.render_grid_as_colors reversed %}
            {% with row_index=forloop.revcounter0 %}
                <tr class="w-full">
                    <td class="w-1/6 text-right pr-2 border-4 border-white">
                        {% with impact=matrix.parse_json.impact|index:row_index %}
                        {{ impact.name }}
                        {% endwith %}
                    </td>
                    {% for item in row %}
                        <td class="w-1/6 h-16 text-center border-4 border-white" style="background-color: {{ item.hexcolor }}">
                            {{ data|index:row_index|index:forloop.counter0|join:", " }}
                        </td>
                    {% endfor %}
                </tr>
            {% endwith %}
        {% endfor %}
        <tr>
            <td></td>
            {% for probability in matrix.parse_json.probability %}
                <td class="w-1/6 h-16 text-center border-4 border-white">
                    {{ probability.name }}
                </td>
            {% endfor %}
        </tr>
    </table>
{% else %}
    <div class="w-full bg-white shadow rounded-lg p-6">
        <h3 class="flex font-bold p-2 m-2 text-lg">{% trans matrix.description %}</h3>
        <div class="flex justify-center">
            <div class="h-16 text-black font-bold text-center ml-4 mt-36 -rotate-90">
                {% trans "Impact" %}
            </div>
            <table class="w-3/4 mt-10">
                {% for row in matrix.render_grid_as_colors reversed %}
                    {% with row_index=forloop.revcounter0 %}
                        <tr>
                            <td class="w-1/6 text-center text-black bg-gray-200 border-4 border-white pr-2">
                                {% with impact=matrix.parse_json.impact|index:row_index %}
                                {{ impact.name }}:
                                {{ impact.description }}
                                {% endwith %}
                            </td>
                            {% if enriched_data %}
                                {% for item in row %}
                                    <td class="w-1/6 h-16 text-center border-4 border-white" style="background-color: {{ item.hexcolor }}">
                                        {{ enriched_data|index:row_index|index:forloop.counter0|join:", " }}
                                    </td>
                                {% endfor %}
                            {% else %}
                                {% for item in row %}
                                <td class="w-1/6 h-16 text-left border-4 border-white" style="background-color: {{ item.hexcolor }}">
                                </td>
                                {% endfor %}
                            {% endif %}
                            </td>
                        </tr>
                    {% endwith %}
                {% endfor %}
                <tr>
                    <td></td>
                    {% for probability in matrix.parse_json.probability %}
                        <td class="w-1/6 h-16 text-center text-black bg-gray-200 border-4 border-white">
                            {{ probability.name }}:
                            {{ probability.description }}
                        </td>
                    {% endfor %}
                </tr>
            </table>
        </div>
        <div class="h-16 text-black font-bold text-center ml-44 mt-4">
            {% trans "Probability" %}
        </div>
    </div>
    <div class="w-full bg-white shadow rounded-lg p-6 mt-2">
        <h3 class="flex font-bold p-2 m-2 text-lg">{% trans "Risk levels" %}</h3>
        <div class="flex justify-center">
            <table class="w-3/4">
                <tr>
                    {% for risk in matrix.parse_json.risk %}
                    <td class="w-1/6 h-16 text-center border-4 border-white" style="background-color: {{ risk.hexcolor }}">
                    </td>
                    {% endfor %}
                </tr>
                <tr>
                    {% for risk in matrix.parse_json.risk %}
                    <td class="w-1/6 h-16 text-center border-4 border-white bg-gray-200">
                        {{ risk.name }}
                    </td>
                    {% endfor %}
                </tr>
                <tr>
                    {% for risk in matrix.parse_json.risk %}
                    <td class="w-1/6 h-16 text-center border-4 border-white bg-gray-200">
                        {{ risk.description }}
                    </td>
                    {% endfor %}
                </tr>
            </table>
        </div>
    </div>
{% endif %}

{% comment %} {% if matrix == 'default' %}

<table class="w-full p-2">
    <tr>
        <td class="text-right font-semibold px-2">{% trans "Impact" %}</td>
    </tr>
    <tr>
        <td class="text-right h-16 px-2">{% trans "Very high" %}</td>
        <td class="w-1/6 text-center M">{% if data.0.0 %}{{data.0.0|join:", "}}{% endif %}</td>
        <td class="w-1/6 text-center M">{% if data.0.1 %}{{data.0.1|join:", "}}{% endif %}</td>
        <td class="w-1/6 text-center H">{% if data.0.2 %}{{data.0.2|join:", "}}{% endif %}</td>
        <td class="w-1/6 text-center VH">{% if data.0.3 %}{{data.0.3|join:", "}}{% endif %}</td>
        <td class="w-1/6 text-center VH">{% if data.0.4 %}{{data.0.4|join:", "}}{% endif %}</td>
    </tr>
    <tr>
        <td class="text-right h-16 px-2">{% trans "High" %}</td>
        <td class="text-center L">{% if data.1.0 %}{{data.1.0|join:", "}}{% endif %}</td>
        <td class="text-center M">{% if data.1.1 %}{{data.1.1|join:", "}}{% endif %}</td>
        <td class="text-center M">{% if data.1.2 %}{{data.1.2|join:", "}}{% endif %}</td>
        <td class="text-center H">{% if data.1.3 %}{{data.1.3|join:", "}}{% endif %}</td>
        <td class="text-center VH">{% if data.1.4 %}{{data.1.4|join:", "}}{% endif %}</td>
    </tr>
    <tr>
        <td class="text-right h-16 px-2">{% trans "Medium" %}</td>
        <td class="text-center L">{% if data.2.0 %}{{data.2.0|join:", "}}{% endif %}</td>
        <td class="text-center L">{% if data.2.1 %}{{data.2.1|join:", "}}{% endif %}</td>
        <td class="text-center M">{% if data.2.2 %}{{data.2.2|join:", "}}{% endif %}</td>
        <td class="text-center M">{% if data.2.3 %}{{data.2.3|join:", "}}{% endif %}</td>
        <td class="text-center H">{% if data.2.4 %}{{data.2.4|join:", "}}{% endif %}</td>
    </tr>
    <tr>
        <td class="text-right h-16 px-2">{% trans "Low" %}</td>
        <td class="text-center VL">{% if data.3.0 %}{{data.3.0|join:", "}}{% endif %}</td>
        <td class="text-center L">{% if data.3.1 %}{{data.3.1|join:", "}}{% endif %}</td>
        <td class="text-center L">{% if data.3.2 %}{{data.3.2|join:", "}}{% endif %}</td>
        <td class="text-center M">{% if data.3.3 %}{{data.3.3|join:", "}}{% endif %}</td>
        <td class="text-center M">{% if data.3.4 %}{{data.3.4|join:", "}}{% endif %}</td>
    </tr>
    <tr>
        <td class="text-right h-16 px-2">{% trans "Very low" %}</td>
        <td class="text-center VL">{% if data.4.0 %}{{data.4.0|join:", "}}{% endif %}</td>
        <td class="text-center VL ">{% if data.4.1 %}{{data.4.1|join:", "}}{% endif %}</td>
        <td class="text-center L">{% if data.4.2 %}{{data.4.2|join:", "}}{% endif %}</td>
        <td class="text-center L">{% if data.4.3 %}{{data.4.3|join:", "}}{% endif %}</td>
        <td class="text-center M">{% if data.4.4 %}{{data.4.4|join:", "}}{% endif %}</td>
    </tr>
    <tr>
        <td class=""></td>
        <td class="text-center">{% trans "Very low" %}</td>
        <td class="text-center">{% trans "Low" %}</td>
        <td class="text-center">{% translate "Medium" context "Probability" %}</td>
        <td class="text-center">{% translate "High" context "Probability" %}</td>
        <td class="text-center">{% translate "Very high" context "Probability" %}</td>
        <td class="font-semibold px-2">{% trans "Probability" %}</td>
    </tr>

</table>
{% endif %}

{% if matrix == 'critical' %}
<table class="w-full p-2">
    <tr>
        <td class="text-right font-semibold px-2">{% trans "Impact" %}</td>
    </tr>
    <tr>
        <td class=" text-right h-16 px-2">{% trans "Very high" %}</td>
        <td class="w-1/6 text-center M">{% if data.0.0 %}{{data.0.0|join:", "}}{% endif %}</td>
        <td class="w-1/6 text-center H">{% if data.0.1 %}{{data.0.1|join:", "}}{% endif %}</td>
        <td class="w-1/6 text-center VH">{% if data.0.2 %}{{data.0.2|join:", "}}{% endif %}</td>
        <td class="w-1/6 text-center VH">{% if data.0.3 %}{{data.0.3|join:", "}}{% endif %}</td>
        <td class="w-1/6 text-center VH">{% if data.0.4 %}{{data.0.4|join:", "}}{% endif %}</td>
    </tr>
    <tr>
        <td class="text-right h-16 px-2">{% trans "High" %}</td>
        <td class="text-center L">{% if data.1.0 %}{{data.1.0|join:", "}}{% endif %}</td>
        <td class="text-center M">{% if data.1.1 %}{{data.1.1|join:", "}}{% endif %}</td>
        <td class="text-center H">{% if data.1.2 %}{{data.1.2|join:", "}}{% endif %}</td>
        <td class="text-center VH">{% if data.1.3 %}{{data.1.3|join:", "}}{% endif %}</td>
        <td class="text-center VH">{% if data.1.4 %}{{data.1.4|join:", "}}{% endif %}</td>
    </tr>
    <tr>
        <td class="text-right h-16 px-2">{% trans "Medium" %}</td>
        <td class="text-center VL">{% if data.2.0 %}{{data.2.0|join:", "}}{% endif %}</td>
        <td class="text-center L">{% if data.2.1 %}{{data.2.1|join:", "}}{% endif %}</td>
        <td class="text-center M">{% if data.2.2 %}{{data.2.2|join:", "}}{% endif %}</td>
        <td class="text-center H">{% if data.2.3 %}{{data.2.3|join:", "}}{% endif %}</td>
        <td class="text-center VH">{% if data.2.4 %}{{data.2.4|join:", "}}{% endif %}</td>
    </tr>
    <tr>
        <td class="text-right h-16 px-2">{% trans "Low" %}</td>
        <td class="text-center VL">{% if data.3.0 %}{{data.3.0|join:", "}}{% endif %}</td>
        <td class="text-center VL">{% if data.3.1 %}{{data.3.1|join:", "}}{% endif %}</td>
        <td class="text-center L">{% if data.3.2 %}{{data.3.2|join:", "}}{% endif %}</td>
        <td class="text-center M">{% if data.3.3 %}{{data.3.3|join:", "}}{% endif %}</td>
        <td class="text-center H">{% if data.3.4 %}{{data.3.4|join:", "}}{% endif %}</td>
    </tr>
    <tr>
        <td class="text-right h-16 px-2">{% trans "Very low" %}</td>
        <td class="text-center VL">{% if data.4.0 %}{{data.4.0|join:", "}}{% endif %}</td>
        <td class="text-center VL ">{% if data.4.1 %}{{data.4.1|join:", "}}{% endif %}</td>
        <td class="text-center VL">{% if data.4.2 %}{{data.4.2|join:", "}}{% endif %}</td>
        <td class="text-center L">{% if data.4.3 %}{{data.4.3|join:", "}}{% endif %}</td>
        <td class="text-center M">{% if data.4.4 %}{{data.4.4|join:", "}}{% endif %}</td>
    </tr>
    <tr>
        <td class=""></td>
        <td class="text-center">{% trans "Very low" %}</td>
        <td class="text-center">{% trans "Low" %}</td>
        <td class="text-center">{% translate "Medium" context "Probability" %}</td>
        <td class="text-center">{% translate "High" context "Probability" %}</td>
        <td class="text-center">{% translate "Very high" context "Probability" %}</td>
        <td class="font-semibold px-2">{% trans "Probability" %}</td>
    </tr>

</table>
{% endif %}

{% if matrix == 'custom' %}
Coming soon
{% endif %} {% endcomment %}