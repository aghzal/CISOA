{% comment %} This version of base.html is required for passkeys{% endcomment %}
{% load static tailwind_tags core_extras %}
{% load i18n %}
{% get_current_language as LANGUAGE_CODE %}
<!DOCTYPE html>
<html lang="{{ LANGUAGE_CODE }}">

<head>
	<title>{% block title %}MIRA{% endblock title %}</title>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<link rel="icon" type="image/x-icon" href="{% static 'favicon.ico' %}">
	<script src="/static/cache/jquery-3.6.3.min.js"></script>
	<link href="/static/cache/fontawesome-free-6.3.0-web/css/all.min.css" rel="stylesheet">

	<meta http-equiv="X-UA-Compatible" content="ie=edge">
	<script defer src="/static/cache/alpine-3.12.0.min.js"></script>
	{% block head %}
	{% endblock %}
	{% tailwind_css %}
	<style>
		.scrollbar {
			overflow-y: scroll;
			scrollbar-color: #694998 transparent;
			scrollbar-width: thin;
		}
		.scrollbar::-webkit-scrollbar {
			margin-top: 22px;
			margin-bottom: 22px;
			width: 3px;
			height: 20px;
		}

		.scrollbar::-webkit-scrollbar-track {
			margin-top: 22px;
			margin-bottom: 22px;
			border-radius: 100vh;
			background: transparent;
		}

		.scrollbar::-webkit-scrollbar-thumb {
			margin-top: 22px;
			margin-bottom: 22px;
			background: #694998;
			border-radius: 100vh;
			borer: 10px solid red;
		}

		.scrollbar::-webkit-scrollbar-thumb:hover {
			background: #563c81;
		}
	</style>
	<script>
		window.onload = function() {
			if (sessionStorage.getItem('sidebar-yscroll')) {
				document.getElementById('sidebar-scroll').scrollTop = sessionStorage.getItem('sidebar-yscroll');
			}
			document.getElementById('sidebar-scroll').addEventListener('scroll', debounce(function(){
				yscroll = document.getElementById('sidebar-scroll').scrollTop;
				sessionStorage.setItem('sidebar-yscroll', yscroll);
			}, 50));

			items = document.querySelectorAll("ul#sidebar-items li.to-page a");
			items.forEach(function(element) {
				if (window.location.pathname.includes(element.getAttribute("href"))) {
					element.classList.remove("nav-link");
					element.classList.add("nav-link-active");
				}
			});
		}
		const debounce = (func, delay) => {
			let debounceTimer;
			return function() {
				const context = this;
				const args = arguments;
				clearTimeout(debounceTimer);
				debounceTimer = setTimeout(() => func.apply(context, args), delay);
			}
		} 
	</script>
	{% comment %} <script>
		window.onload = function() {
			items = document.querySelectorAll("ul#sidebar-items li.to-page a");
			console.log(window.location.pathname);
			items.forEach(function(element) {
				console.log(element.getAttribute("href"));
				console.log((element.getAttribute("href") == window.location.pathname))
				if (element.getAttribute("href") == window.location.pathname) {
					element.classList.remove("nav-link");
					element.classList.add("nav-link-active");
				}
			});
		}
	</script> {% endcomment %}
</head>
<body class="bg-slate-200 h-full w-full max-w-screen bg-no-repeat m-0 bg-fixed">
	<style>
		[x-cloak] { display: none }
	</style>
	<div x-data="{ sidebarOpen: true, modalOpen: false, aboutModalOpen: false, sidebarAnimation: false }" class="flex h-screen">
		{% include 'core/sidebar.html' %}
		{% include 'snippets/messages.html' %}
		<div class="flex-1">
			<main class="px-8 pb-8" :class="sidebarOpen == false ? 'ml-4' + (sidebarAnimation == false ? '' : ' transition-all duration-300') : 'ml-72' + (sidebarAnimation == false ? '' : ' transition-all duration-300')">
				{% block content %}
					{% comment %} {% include 'snippets/breadcrumbs.html' %} {% endcomment %}
				{% endblock %}
				{% comment %} 
					the 'About MIRA' modal summoned from the sidebar was placed here to fix its rendering on Safari.
				{% endcomment %}
				{% include 'snippets/modal/modal_about_mira.html' with header=_("About MIRA") %}
			</main>
		</div>
	</div>
</body>

</html>