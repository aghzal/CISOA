{% extends 'core/base.html' %}

{% load i18n %}

{% block head %}
<script src="https://cdn.jsdelivr.net/npm/echarts@5.3.2/dist/echarts.min.js"></script>
{% endblock %}
{% block content %}
<div class="h-screen" x-data="{ openTab: 1 }">
    {% with page_title=_('Analytics') %}
    {% include 'back_office/snippets/breadcrumbs.html' %}
    {% endwith %}

    <div class="px-4 flex flex-row">
        <div @click="openTab = 1" class="cursor-pointer px-2 w-fit border-indigo-500 hover:bg-gray-200 rounded-t hover:border-indigo-700" :class="openTab == 1 ? 'border-b-2 bg-gray-100' : 'border-b-0'">{% trans "Analytics" %}</div>
        <div @click="openTab = 2" class="cursor-pointer px-2 w-fit border-indigo-500 hover:bg-gray-200 rounded-t hover:border-indigo-700" :class="openTab == 2 ? 'border-b-2 bg-gray-100' : 'border-b-0'">{% trans "My projects" %}</div>
        <div @click="openTab = 3" class="cursor-pointer px-2 w-fit border-indigo-500 hover:bg-gray-200 rounded-t hover:border-indigo-700" :class="openTab == 3 ? 'border-b-2 bg-gray-100' : 'border-b-0'">{% trans "Composer" %}</div>
    </div>

    <div x-show="openTab === 1">
        <section class="p-2 bg-white rounded-lg shadow-lg mb-6" id="stats">
            <div class="p-2 m-2">
                <span class="text-2xl font-extrabold text-slate-700">{% trans "Statistics" %}</span>
            </div>
            <div class="flex items-center content-center">
                <div class="w-1/4 p-2 m-2  flex content-center bg-white">
                    <div class="text-5xl text-yellow-500 mr-2"><i class="fas fa-biohazard"></i></div>
                    <div class=" text-left"><div class="text-4xl font-bold">{{ counters.Threat }}</div> <div class="font-semibold text-slate-500 text-sm">{% trans "Threats" %}</div></div>
                </div>
                <div class="w-1/4 p-2 m-2  flex content-center bg-white">
                    <div class="text-5xl text-blue-500 mr-2"><i class="fas fa-glasses"></i></div>
                    <div class=" text-left"><div class="text-4xl font-bold">{{ counters.Analysis }}</div> <div class="font-semibold text-slate-500 text-sm">{% trans "Analyses" %}</div></div>
                </div>
                <div class="w-1/4 p-2 m-2  flex content-center bg-white">
                    <div class="text-5xl text-green-500 mr-2"><i class="fas fa-clone"></i></div>
                    <div class=" text-left"><div class="text-4xl font-bold">{{ counters.RiskScenario }}</div> <div class="font-semibold text-slate-500 text-sm">{% trans "Scenarios" %}</div></div>
                </div>
                <div class="w-1/4 p-2 m-2  flex content-center bg-white">
                    <div class="text-5xl text-red-500 mr-2"><i class="fas fa-fire-extinguisher"></i></div>
                    <div class=" text-left"><div class="text-4xl font-bold">{{ counters.SecurityMeasure }}</div> <div class="font-semibold text-slate-500 text-sm">{% trans "Security measures" %}</div></div>
                </div>
            </div>
        </section>

        <section class="p-2 bg-white rounded-lg shadow-lg mb-6 " id="">
            <div class="p-2 m-2">
                <div class="text-2xl font-extrabold text-slate-700">{% trans "My projects" %}</div>
                <div class="text-sm text-slate-500 font-semibold">{% trans "Assigned to" %} <span class="font-bold text-slate-700">{{ counters.Project }}</span> {% trans "projects" %}</div>
            </div>
            <div class="flex items-center content-center">
                <div class=" p-2 m-2 w-1/2">
                    <span class="text-sm font-semibold">{% trans "Risk scenarios overview" %}</span>
                    <!--Chart starts here-->
                    {% include 'back_office/fragments/animated_donut_chart.html' with name='risk_scenarios_overview' values=risks_level.current %}
                    <!--Chart ends here-->
                </div>
                <div class="p-2 m-2 w-1/2">
                    <span class="text-sm font-semibold">{% trans "Security measures status" %}</span>
                    {% include 'back_office/fragments/measures_status.html' with name='security_measures_status' labels=security_measure_status.labels values=security_measure_status.values %}
                </div>
            </div>
        </section>

        <section class="p-2 bg-white rounded-lg shadow-lg mb-6" id="">
            <div class="p-2 m-2">
                <div class="text-2xl font-extrabold text-slate-700">{% trans "Watch list" %}</div>
                <div class="text-sm text-slate-500 font-semibold">{% trans "Items that have expired or with close ETA" %}</div>
            </div>
            <div class="p-2 m-2 flex flex-col space-y-5 items-center content-center">
                <div class="w-full">
                    <span class="text-md font-semibold">{% trans "Measures to review" %}</span>
                    <div>{% include 'back_office/fragments/watchlist_measures.html' %}</div>
                </div>
                <div class="w-full">
                    <span class="text-md font-semibold">{% trans "Exceptions to review" %}</span>
                    <div>{% include 'back_office/fragments/watchlist_exceptions.html' %}</div>
                </div>
            </div>
        </section>
    </div>
    <div x-show="openTab === 3">
        {% include 'core/project_select.html' with analyses=analyses %}
    </div>
    <div x-show="openTab === 2">
        {% include 'core/my_projects.html' with agg_data=agg_data measures=ord_security_measures %}
    </div>
</div>
</div>
{% endblock %}